# Requirements Document

## Project Description (Input)
docs/要件定義書.mdのようなアプリを作りたい

## Introduction
Mood Harbor（気分の港）は、文字入力なしでタップのみで感情を記録し、温かいコミュニティでユーザー同士が励まし合える学生向け感情記録アプリケーションです。「10秒で完了」「文字入力ゼロ」「感情に特化」という3つの核となる価値を提供し、日記が続かないユーザーでも継続できる体験を実現します。

## Requirements

### Requirement 1: ユーザー認証・アカウント管理
**Objective:** As a ユーザー, I want 安全にアカウントを作成・管理できる機能, so that 自分のデータを保護しながらサービスを利用できる

#### Acceptance Criteria
1. When ユーザーがメールアドレスとパスワードを入力して登録ボタンをクリック, the システム shall アカウントを作成しパスワードをハッシュ化して保存する
2. When ユーザーがGoogleアカウント連携ボタンをクリック, the システム shall Google OAuth認証フローを開始する
3. When ユーザーがログインボタンをクリック, the システム shall 認証情報を検証しセッションを確立する
4. When ユーザーがアカウント削除を実行, the システム shall 全ての個人データを完全に削除する
5. The システム shall パスワードに対してbcryptまたはArgon2によるハッシュ化を適用する
6. The システム shall HTTPS通信のみを許可する

### Requirement 2: プロフィール設定
**Objective:** As a ユーザー, I want ニックネームとアバターを設定できる機能, so that 匿名性を保ちながら個性を表現できる

#### Acceptance Criteria
1. When ユーザーが初回登録を完了, the システム shall プロフィール設定画面を表示する
2. When ユーザーがニックネームを入力, the システム shall 10文字以内の制限を適用する
3. When ユーザーがアバター選択画面を開く, the システム shall 30種類以上のプリセットアバターを表示する
4. When ユーザーがランダム生成ボタンをクリック, the システム shall 「港の旅人123」形式のランダムニックネームを生成する
5. The システム shall アバターをカテゴリー（動物、植物、食べ物、天気など）ごとに分類して表示する

### Requirement 3: 気分記録フロー（3ステップ）
**Objective:** As a ユーザー, I want タップだけで10秒以内に気分を記録できる機能, so that 手軽に毎日の感情を追跡できる

#### Acceptance Criteria
1. When ユーザーが記録ボタンをタップ, the システム shall ステップ1（気分選択）画面を表示する
2. When ユーザーが5段階気分アイコンのいずれかをタップ, the システム shall 選択を保存し自動的にステップ2へ遷移する
3. When ユーザーがステップ2で理由カテゴリーをタップ, the システム shall 最大2つまで選択を許可する
4. When ユーザーがステップ3で日替わり質問に回答, the システム shall 記録を完了し完了画面を表示する
5. The システム shall 記録完了までの所要時間を15秒以内に制限する設計とする
6. When ユーザーが記録を完了, the システム shall 完了アニメーション（船が港に入るイメージ）を表示する
7. The システム shall ステップ1で「とても良い」「良い」「普通」「少し疲れた」「とても疲れた」の5つの気分レベルを提供する
8. The システム shall ステップ2で「勉強・学校」「人間関係」「体調・健康」「趣味・遊び」「バイト・仕事」「家族・家のこと」「睡眠」「特に理由なし」の8カテゴリーを提供する

### Requirement 4: 日替わり質問機能
**Objective:** As a ユーザー, I want 毎日異なる質問で感情の詳細を記録できる機能, so that 多面的に自分の状態を振り返ることができる

#### Acceptance Criteria
1. When ユーザーがステップ3に到達, the システム shall 当日の日替わり質問を1つ表示する
2. The システム shall 質問カテゴリーとして「人とのつながり系」「活動系」「達成感系」「気持ち系」「週末用質問」を用意する
3. When 金曜日または土曜日である, the システム shall 「今週どうだった？」など週末用質問を優先表示する
4. When 日曜日である, the システム shall 「来週の気持ちは？」など来週準備用質問を表示する
5. The システム shall 各質問に対して3-4つの選択肢を提供する
6. When ユーザーが選択肢をタップ, the システム shall 回答を保存し記録を完了する

### Requirement 5: 補足入力機能（オプション）
**Objective:** As a ユーザー, I want 必要に応じて追加情報を記録できる機能, so that より詳細な記録を残せる

#### Acceptance Criteria
1. When ユーザーが記録完了後に「もう少し詳しく」ボタンをタップ, the システム shall 補足入力画面を表示する
2. When ユーザーがメモを入力, the システム shall 10文字以内の制限を適用する
3. If メモが10文字を超過, then the システム shall 追加入力を拒否する
4. When ユーザーが時間帯タグを選択, the システム shall 「朝」「昼」「夕方」「夜」の4つから選択を許可する
5. When ユーザーが天気を選択, the システム shall 「晴れ」「曇り」「雨」「その他」の4つから選択を許可する
6. The システム shall 補足入力をスキップ可能とする

### Requirement 6: カレンダー表示機能
**Objective:** As a ユーザー, I want 月間カレンダーで過去の気分を視覚的に確認できる機能, so that 感情の推移を俯瞰できる

#### Acceptance Criteria
1. When ユーザーがカレンダータブを開く, the システム shall 月間カレンダービューを表示する
2. The システム shall 記録済みの日を5段階の気分に対応した色で表示する
3. The システム shall 記録していない日を灰色で表示する
4. When ユーザーが日付をタップ, the システム shall その日の記録詳細をモーダルで表示する
5. The システム shall 詳細表示に「気分アイコン」「理由カテゴリー」「質問と回答」「メモ（あれば）」「時間帯・天気（あれば）」「シェア状態」を含める
6. When ユーザーが詳細モーダルで編集ボタンをタップ, the システム shall 記録編集画面を表示する
7. When ユーザーが詳細モーダルで削除ボタンをタップ, the システム shall 確認ダイアログを表示する
8. The システム shall 連続記録日数をカレンダー画面の目立つ位置に表示する

### Requirement 7: 週間サマリー機能
**Objective:** As a ユーザー, I want 毎週月曜朝に先週の気分サマリーを受け取れる機能, so that 週単位で感情を振り返れる

#### Acceptance Criteria
1. When 月曜日の朝9時になる, the システム shall 先週の週間サマリー通知を送信する
2. The システム shall 週間サマリーに「先週の気分グラフ（折れ線グラフ）」「最も多かった気分」「記録日数/7日」「最も多かった理由カテゴリー」を含める
3. When ユーザーが週間サマリー通知をタップ, the システム shall 詳細なサマリー画面を表示する
4. The システム shall 「先週お疲れ様！」など励ましメッセージを表示する
5. When ユーザーが週間サマリー設定をオフにする, the システム shall 通知を送信しない

### Requirement 8: 月間レポート機能
**Objective:** As a ユーザー, I want 月間の気分分布と傾向を確認できる機能, so that 長期的な感情パターンを理解できる

#### Acceptance Criteria
1. When ユーザーが統計タブを開く, the システム shall 月間レポートを表示する
2. The システム shall 月間の気分分布を円グラフで表示する
3. The システム shall 曜日別の気分傾向を棒グラフで表示する
4. The システム shall 理由カテゴリーの割合を表示する
5. The システム shall 連続記録最長日数を表示する
6. The システム shall よく選んだ質問回答の傾向を表示する

### Requirement 9: インサイト機能
**Objective:** As a ユーザー, I want データが溜まると自動的にパターンを検出して教えてくれる機能, so that 自己理解を深められる

#### Acceptance Criteria
1. When 記録データが30日以上蓄積される, the システム shall パターン検出を開始する
2. When 雨の日の気分が平均より低いパターンを検出, the システム shall 「雨の日は気分が下がりがち」とインサイトを表示する
3. When 特定曜日・時間帯の気分パターンを検出, the システム shall 該当するインサイトを表示する
4. When 特定活動と気分の相関を検出, the システム shall 「趣味の日は気分が良い」などインサイトを表示する
5. The システム shall インサイトを統計画面のテキストカードとして表示する

### Requirement 10: シェア機能
**Objective:** As a ユーザー, I want 記録後にタップだけで感情をシェアできる機能, so that 他のユーザーとつながりを持てる

#### Acceptance Criteria
1. When ユーザーが記録完了後に「シェアする」ボタンをタップ, the システム shall シェア種類選択画面を表示する
2. The システム shall 「💙 励まし募集」「💛 喜びシェア」「💚 頑張った報告」の3種類のシェアタイプを提供する
3. When ユーザーがシェア種類を選択, the システム shall 該当する気持ち選択画面を表示する
4. When ユーザーが「励まし募集」を選択, the システム shall 「とても辛い」「疲れた」「不安」「モヤモヤする」の4つの気持ちを表示する
5. When ユーザーが「喜びシェア」を選択, the システム shall 「すごく嬉しい！」「良いことがあった」「幸せ」「充実してる」の4つの気持ちを表示する
6. When ユーザーが「頑張った報告」を選択, the システム shall 「やり切った！」「勉強頑張った」「体動かした」「目標達成」の4つの気持ちを表示する
7. When ユーザーが気持ちをスキップ, the システム shall 一言入力画面へ遷移する
8. When ユーザーが一言を入力, the システム shall 10文字以内の制限を適用する
9. The システム shall 定型文ボタン（シェア種類ごとに最適化）を提供する
10. When ユーザーが投稿ボタンをタップ, the システム shall 投稿を保存しハーバーに公開する
11. The システム shall 投稿に「気分アイコン」「シェア種類」「選んだ気持ち」「一言（あれば）」「投稿時刻」「ニックネーム/アバター」を含める
12. The システム shall 投稿に「理由カテゴリー」「質問への回答」「個人メモ」を含めない

### Requirement 11: ハーバー（タイムライン）機能
**Objective:** As a ユーザー, I want 他のユーザーの投稿を閲覧できるタイムライン機能, so that コミュニティとつながれる

#### Acceptance Criteria
1. When ユーザーがハーバータブを開く, the システム shall 3つのタブ（励まし募集、喜びシェア、頑張った報告）を表示する
2. When ユーザーがタブを切り替え, the システム shall 該当するシェア種類の投稿のみを表示する
3. The システム shall 投稿を新しい順に表示する
4. The システム shall 応援が多い投稿を表示順で少し優先する
5. When ユーザーがプルダウン操作を実行, the システム shall 最新の投稿を読み込む
6. When 新しい投稿が存在する, the システム shall 「新着○件」と表示する
7. The システム shall 各投稿カードに「アバター」「ニックネーム」「気分アイコン」「気持ち」「一言（あれば）」「投稿時刻（相対表示）」「応援数」「応援ボタン」を表示する
8. When 投稿が24時間経過, the システム shall 自動的に投稿を削除する
9. When 投稿削除前である, the システム shall ユーザーに「あなたの投稿は○○人に応援されました」と通知する

### Requirement 12: フィルター機能
**Objective:** As a ユーザー, I want ハーバーの投稿をフィルタリングできる機能, so that 関心のある投稿を見つけやすくなる

#### Acceptance Criteria
1. When ユーザーがフィルターボタンをタップ, the システム shall フィルター選択画面を表示する
2. When ユーザーが時間帯フィルターを適用, the システム shall 「朝」「昼」「夕」「夜」の指定時間帯に投稿されたもののみを表示する
3. When ユーザーが「すべて表示」を選択, the システム shall 全ての投稿を表示する

### Requirement 13: 応援・リアクション機能
**Objective:** As a ユーザー, I want タップ1回で他のユーザーを応援できる機能, so that 気軽に励まし合える

#### Acceptance Criteria
1. When ユーザーが投稿カードの「応援する」ボタンをタップ, the システム shall スタンプ選択モーダルを表示する
2. When 投稿が「励まし募集」である, the システム shall 「応援してる！」「大丈夫だよ」「無理しないでね」「明日はきっといい日」「一緒に頑張ろう」「わかるよ」の6つのスタンプを表示する
3. When 投稿が「喜びシェア」である, the システム shall 「おめでとう！」「すごい！」「よかったね」「嬉しいね」「素敵！」「私も嬉しい」の6つのスタンプを表示する
4. When 投稿が「頑張った報告」である, the システム shall 「お疲れ様！」「やったね！」「かっこいい」「すごい！」「頑張ったね」「尊敬する」の6つのスタンプを表示する
5. When ユーザーがスタンプをタップ, the システム shall 応援を保存し完了アニメーションを表示する
6. If ユーザーが既に同じ投稿に応援済みである, then the システム shall 追加の応援を拒否する
7. If ユーザーが自分の投稿に応援しようとする, then the システム shall 応援を拒否する
8. When 応援後30秒以内である, the システム shall 応援の取り消しを許可する
9. When ユーザーの投稿が応援される, the システム shall リアルタイムで通知を送信する（設定による）
10. When ユーザーが応援通知をタップ, the システム shall 誰がどのスタンプを送ったかを表示する

### Requirement 14: 通知機能
**Objective:** As a ユーザー, I want 記録リマインダーや応援通知を受け取れる機能, so that 継続的に利用できる

#### Acceptance Criteria
1. When 設定された時刻（デフォルト21時）になる and ユーザーが未記録である, the システム shall 記録リマインダー通知を送信する
2. When ユーザーが記録リマインダー通知をタップ, the システム shall 記録画面を直接表示する
3. When ユーザーの投稿が応援される and リアルタイム通知がオンである, the システム shall 即座に通知を送信する
4. When ユーザーの投稿が応援される and まとめ通知がオンである, the システム shall 1日1回まとめて通知を送信する
5. When 連続記録中である and 夜21時に未記録である, the システム shall 「○日連続記録中！今日も記録しませんか？」と通知する
6. When おやすみモードが有効である, the システム shall 設定された夜間時間帯の通知を送信しない
7. When ユーザーが通知一時停止を設定, the システム shall 指定期間（1日/3日/1週間/無期限）通知を停止する

### Requirement 15: プライバシー設定機能
**Objective:** As a ユーザー, I want 投稿の公開範囲とプライバシーを管理できる機能, so that 安心してサービスを利用できる

#### Acceptance Criteria
1. When ユーザーがプライバシー設定を開く, the システム shall 投稿の公開範囲設定を表示する
2. The システム shall 「全体公開（デフォルト）」「公開しない（記録のみ）」の2つの公開範囲を提供する
3. When ユーザーが「公開しない」を選択, the システム shall 全てのシェア機能を無効化する
4. When ユーザーがブロック機能を使用, the システム shall 指定ユーザーの投稿を非表示にする
5. When ユーザーが他ユーザーをブロック, the システム shall 相手に通知を送信しない

### Requirement 16: データエクスポート機能
**Objective:** As a ユーザー, I want 自分の記録データをエクスポートできる機能, so that データの可搬性を確保できる

#### Acceptance Criteria
1. When ユーザーがデータエクスポートを実行, the システム shall 全ての記録をJSON形式でダウンロード可能にする
2. When ユーザーがCSV形式を選択, the システム shall 記録データをCSV形式でエクスポートする
3. The システム shall エクスポートデータに「気分レベル」「理由カテゴリー」「質問と回答」「メモ」「投稿情報」「タイムスタンプ」を含める
4. The システム shall GDPR準拠のデータポータビリティを保証する

### Requirement 17: オンボーディング機能
**Objective:** As a 新規ユーザー, I want 初回起動時に使い方を学べる機能, so that スムーズにサービスを開始できる

#### Acceptance Criteria
1. When ユーザーが初回登録を完了, the システム shall チュートリアル画面を表示する
2. The システム shall 「毎日3タップで記録完了」「シェアして誰かとつながれる」「応援もタップだけ」をアニメーションで説明する
3. When ユーザーがチュートリアルをスキップ, the システム shall 初回気分記録画面へ遷移する
4. When ユーザーが初回記録を完了, the システム shall 「これだけ！」と完了メッセージを表示する
5. The システム shall プライバシーポリシーへの同意を必須とする

### Requirement 18: パフォーマンス要件
**Objective:** As a ユーザー, I want 快適な速度でアプリを利用できる, so that ストレスなく記録できる

#### Acceptance Criteria
1. The システム shall ページ読み込み時間を2秒以内にする
2. The システム shall 気分記録の保存を1秒以内に完了する
3. The システム shall タイムライン表示を3秒以内に完了する
4. The システム shall モバイルデバイスで60FPSの滑らかなアニメーションを実現する

### Requirement 19: セキュリティ要件
**Objective:** As a ユーザー, I want データが安全に保護される, so that 安心してサービスを利用できる

#### Acceptance Criteria
1. The システム shall パスワードに対してbcryptまたはArgon2によるハッシュ化を適用する
2. The システム shall 全ての通信にHTTPSを使用する
3. The システム shall XSS（クロスサイトスクリプティング）対策を実装する
4. The システム shall CSRF（クロスサイトリクエストフォージェリ）対策を実装する
5. The システム shall 個人情報の暗号化を実装する
6. The システム shall SQL インジェクション対策を実装する

### Requirement 20: 可用性・スケーラビリティ要件
**Objective:** As a サービス運営者, I want システムが安定稼働し拡張可能である, so that ユーザーに継続的なサービスを提供できる

#### Acceptance Criteria
1. The システム shall 稼働率99%以上を維持する
2. The システム shall 定期メンテナンスを深夜帯に実施する
3. The システム shall 初期想定1000ユーザーに対応する
4. The システム shall 将来的に10000ユーザーまでスケール可能な設計とする

### Requirement 21: アクセシビリティ要件
**Objective:** As a 全てのユーザー, I want アクセシブルなUIを利用できる, so that 誰でも使いやすいサービスとなる

#### Acceptance Criteria
1. The システム shall ARIA属性を適切に実装する
2. The システム shall モバイルファーストデザインを採用する
3. The システム shall レスポンシブデザインでタブレット・PCでも利用可能にする
4. The システム shall タップ可能なボタンを最小44x44pxのサイズにする
5. The システム shall 色覚異常ユーザーにも識別可能な色使いを採用する
